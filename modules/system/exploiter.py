"""
modules/system/exploiter.py
Safe, demo-only payload generator for system-level PoCs (for lab).
Functions return command strings or JSON describing steps; they DO NOT execute remote commands.
"""

def build_reverse_shell_cmd(ip: str, port: int, shell_type: str = "bash"):
    """
    Returns a demo reverse-shell command string â€” **do not execute** on remote hosts without authorization.
    For demo: returns an echo command that simulates behavior.
    """
    # We avoid providing real reverse shell payloads. Provide a harmless simulation.
    return f"echo 'demo reverse shell connect to {ip}:{port} (simulated)'> /tmp/poc_sim_{ip.replace('.','_')}.txt"

def demo_write_file_cmd(path: str, content: str):
    """
    Returns a command that writes content to a file (safe demo).
    """
    safe_content = content.replace("'", "'\"'\"'")
    return f"printf '%s' '{safe_content}' > {path}"

def poc_plan_system_demo(target_ip: str):
    """
    Returns a JSON-serializable plan describing steps to validate system-level access (simulated).
    """
    return {
        "target": target_ip,
        "steps": [
            {"step":1, "action":"check_reachability", "tool":"ping/tcp"},
            {"step":2, "action":"write_demo_file", "cmd": demo_write_file_cmd("/tmp/pentest_demo.txt", "pentest ok")},
            {"step":3, "action":"generate_reverse_shell_cmd", "cmd": build_reverse_shell_cmd(target_ip, 4444)}
        ],
        "note": "These are simulation commands for demo; do not run against non-authorized hosts."
    }
